#if 0
	shc Version 3.8.9, Generic Script Compiler
	Copyright (c) 1994-2012 Francisco Rosales <frosal@fi.upm.es>

	shc -r -f validation_script 
#endif

static  char data [] = 
#define      lsto_z	1
#define      lsto	((&data[0]))
	"\233"
#define      pswd_z	256
#define      pswd	((&data[51]))
	"\005\361\240\210\273\025\233\051\006\313\316\300\266\061\337\350"
	"\237\046\250\177\001\336\112\174\165\275\211\212\277\117\215\305"
	"\101\055\115\374\103\350\046\111\264\364\012\152\045\352\123\305"
	"\021\374\104\065\314\156\157\177\026\073\165\103\050\173\102\213"
	"\142\257\050\167\263\146\026\204\071\242\242\217\243\125\310\031"
	"\257\014\117\173\173\276\373\222\371\161\326\042\354\031\255\117"
	"\310\325\306\173\073\335\000\165\200\243\004\044\370\314\075\250"
	"\331\214\044\125\112\037\350\104\220\276\146\175\327\024\315\240"
	"\351\224\034\045\161\035\232\362\300\236\026\271\153\123\141\104"
	"\337\206\231\052\245\201\156\066\100\325\264\030\351\201\271\323"
	"\026\325\370\207\362\222\172\262\061\220\154\234\343\315\341\303"
	"\124\173\356\371\375\135\060\076\062\344\126\034\146\017\357\174"
	"\345\347\004\330\172\176\212\254\016\367\111\362\305\053\265\031"
	"\246\244\023\243\001\103\341\064\050\070\120\216\110\100\013\055"
	"\050\017\006\243\215\221\117\234\210\231\216\115\304\104\146\152"
	"\350\171\016\352\275\357\036\345\050\157\164\160\257\200\236\327"
	"\217\244\172\035\065\312\271\276\143\110\013\050\215\161\223\165"
	"\353\241\140\250\221\176\216\271\356\003\052\235\203\311\165\022"
	"\156\360\060\244\272\352\142\036\062\156\107\300\337\332\065\313"
	"\173\226"
#define      shll_z	10
#define      shll	((&data[307]))
	"\053\041\252\344\172\232\127\331\147\327\216\216"
#define      inlo_z	3
#define      inlo	((&data[319]))
	"\301\232\270"
#define      text_z	2719
#define      text	((&data[354]))
	"\150\321\251\226\037\246\331\010\314\043\274\300\056\047\346\031"
	"\173\253\052\167\357\074\123\176\313\244\312\343\177\326\114\347"
	"\255\104\012\355\246\167\105\354\276\112\022\004\356\332\155\140"
	"\134\347\033\276\373\155\336\020\124\233\216\334\077\304\370\332"
	"\242\315\037\036\260\234\257\121\201\252\111\270\034\001\207\171"
	"\222\316\177\265\071\370\227\373\327\163\341\233\305\102\056\075"
	"\261\226\372\065\115\214\372\342\102\337\320\256\210\330\056\251"
	"\240\364\357\174\301\105\372\165\142\147\352\372\275\006\324\234"
	"\103\226\326\351\061\202\124\256\055\230\164\066\016\353\045\171"
	"\276\065\120\104\070\016\176\251\367\227\063\342\302\137\263\054"
	"\174\051\305\001\230\213\205\250\356\136\375\206\361\121\231\166"
	"\260\007\024\224\032\001\100\016\006\134\374\334\244\061\257\270"
	"\307\017\060\241\243\334\130\176\116\071\353\070\304\312\172\146"
	"\312\060\176\272\266\216\100\120\312\141\346\004\153\017\076\106"
	"\233\333\331\064\072\364\363\060\015\303\146\254\057\211\117\000"
	"\203\245\201\020\004\152\071\244\066\311\071\372\030\126\156\361"
	"\022\072\001\203\310\326\247\371\175\236\102\120\267\115\363\222"
	"\277\175\221\024\151\363\272\321\172\061\374\014\364\315\120\304"
	"\062\307\264\334\154\236\045\172\332\353\231\110\021\141\266\157"
	"\315\246\055\170\377\050\120\367\315\154\266\373\147\002\054\033"
	"\370\343\133\070\360\031\015\201\174\242\174\256\216\353\237\126"
	"\131\100\015\367\113\013\054\021\112\130\346\043\216\047\216\156"
	"\137\360\100\151\151\076\070\035\322\304\310\374\322\013\352\036"
	"\177\254\304\303\232\173\367\352\367\273\265\001\264\242\305\332"
	"\266\105\042\234\245\225\277\130\214\103\151\207\347\371\065\173"
	"\216\310\257\331\342\231\076\304\263\037\346\105\057\205\152\273"
	"\127\262\372\040\152\135\320\121\355\267\141\241\114\222\064\120"
	"\336\317\302\051\141\037\006\326\335\322\351\030\051\306\354\111"
	"\101\251\123\372\242\266\046\351\221\071\342\242\037\207\341\167"
	"\314\071\176\056\150\262\232\074\373\007\173\071\167\105\230\310"
	"\146\217\326\062\364\170\232\077\045\022\133\323\240\347\137\073"
	"\147\350\306\177\343\166\130\305\215\023\371\374\144\163\311\031"
	"\213\272\154\037\335\046\151\145\311\203\326\070\272\167\111\154"
	"\011\062\175\343\231\134\125\161\110\335\016\034\353\020\263\235"
	"\247\041\163\163\216\072\356\062\304\123\366\360\161\355\023\346"
	"\025\037\062\060\256\247\055\271\254\331\350\126\265\364\366\111"
	"\062\120\321\067\043\021\002\227\274\247\247\032\337\301\236\037"
	"\110\340\060\125\271\015\144\072\334\067\205\265\160\273\206\060"
	"\054\254\157\211\207\004\067\033\043\053\021\007\167\015\004\003"
	"\351\216\336\361\352\322\052\023\274\140\121\214\340\126\330\207"
	"\257\314\026\027\243\305\166\225\073\270\103\245\202\373\241\142"
	"\175\026\051\035\023\374\053\270\022\047\211\020\212\130\363\014"
	"\012\036\037\256\355\074\065\171\026\276\140\102\274\317\102\345"
	"\064\061\106\165\364\371\242\002\235\374\224\340\120\254\140\103"
	"\310\341\042\072\043\165\335\022\062\165\066\314\142\240\034\151"
	"\073\223\071\266\015\116\310\133\250\174\025\350\326\055\335\301"
	"\053\344\127\206\062\143\101\350\106\306\351\203\267\304\107\025"
	"\146\176\153\356\326\113\310\165\304\136\344\034\040\112\353\244"
	"\044\327\154\144\163\267\133\124\050\340\063\010\163\253\005\141"
	"\314\075\204\367\250\102\214\045\272\302\175\156\356\150\220\067"
	"\346\113\021\156\051\036\270\146\357\253\277\004\217\377\050\267"
	"\013\350\322\201\213\025\140\161\223\242\075\364\231\266\356\105"
	"\264\261\074\160\363\230\155\345\206\102\061\267\227\363\305\047"
	"\201\321\341\143\213\124\132\327\267\156\304\374\055\131\054\311"
	"\203\236\135\066\372\332\311\234\357\222\144\040\007\314\263\346"
	"\057\174\047\374\333\256\144\045\011\142\117\211\120\374\074\132"
	"\035\030\262\236\007\340\156\377\332\211\213\215\115\176\306\325"
	"\162\031\075\105\164\075\065\274\004\112\324\073\041\334\303\220"
	"\057\243\125\321\273\277\215\130\147\020\054\176\170\231\147\160"
	"\070\327\116\240\377\321\212\275\067\347\143\246\133\334\274\003"
	"\044\111\342\313\045\072\147\265\062\353\207\116\244\226\356\103"
	"\106\122\170\023\360\104\355\257\223\156\123\322\331\271\271\173"
	"\043\367\163\306\053\310\153\200\044\371\361\020\015\054\017\024"
	"\145\072\140\331\002\335\144\236\126\346\024\333\341\235\032\222"
	"\332\340\367\070\214\151\265\163\156\231\074\245\125\021\342\322"
	"\217\350\157\017\322\340\251\064\342\374\146\310\037\263\313\100"
	"\323\024\245\046\361\116\022\266\275\037\055\054\167\161\322\351"
	"\051\261\223\267\300\202\133\005\150\103\352\113\263\327\257\363"
	"\237\322\012\212\211\162\131\352\173\142\173\057\151\145\151\154"
	"\156\114\143\141\122\102\066\125\361\160\017\000\053\065\303\067"
	"\103\261\353\104\270\235\010\103\276\134\274\003\370\373\223\251"
	"\322\222\043\155\303\177\052\303\160\114\245\147\326\274\350\357"
	"\343\320\303\320\262\067\045\321\210\030\161\221\141\320\325\137"
	"\034\354\142\224\330\262\060\023\053\265\166\337\330\253\121\002"
	"\103\135\335\240\301\020\353\377\276\053\263\256\041\065\046\075"
	"\061\025\336\206\240\213\203\351\140\015\165\324\365\107\100\025"
	"\072\063\376\114\306\142\362\125\060\106\344\205\304\335\032\165"
	"\124\232\242\102\221\221\053\345\031\243\060\067\132\220\144\002"
	"\136\016\270\373\046\356\055\077\015\301\204\016\137\311\100\150"
	"\176\061\021\274\023\302\203\176\131\343\063\104\113\061\134\160"
	"\202\213\123\037\265\356\274\115\171\104\072\311\350\310\053\320"
	"\103\264\122\216\273\220\142\204\174\155\011\370\336\333\034\242"
	"\250\042\112\273\271\330\336\355\121\120\144\024\122\376\227\306"
	"\127\107\213\315\204\106\106\274\231\002\232\325\127\307\164\355"
	"\376\174\267\021\340\326\035\363\061\056\241\106\216\331\022\322"
	"\045\212\211\357\237\357\253\025\135\365\222\143\267\161\032\333"
	"\067\205\074\216\014\176\176\316\352\243\162\176\234\154\336\373"
	"\267\244\172\336\334\370\127\270\025\203\212\365\273\240\377\170"
	"\044\256\323\017\124\327\067\167\013\334\127\032\267\176\246\217"
	"\313\133\136\370\331\072\270\222\172\324\137\376\235\001\070\027"
	"\174\252\171\021\365\366\130\371\046\275\367\116\066\315\300\245"
	"\245\325\116\303\135\032\354\236\365\147\104\165\276\357\227\222"
	"\263\155\221\007\265\014\006\157\121\130\365\041\240\020\326\212"
	"\324\252\022\331\042\062\135\336\330\013\244\323\330\360\127\073"
	"\211\315\325\135\220\232\147\056\065\360\243\307\302\220\341\026"
	"\177\044\357\300\071\260\025\251\230\135\321\114\132\104\267\265"
	"\101\144\024\003\313\205\273\242\163\347\013\040\143\112\150\336"
	"\024\252\160\275\320\256\157\235\054\341\356\225\012\360\303\251"
	"\266\330\203\152\241\136\055\335\122\140\106\356\100\043\266\264"
	"\341\062\226\100\367\302\266\006\377\331\146\105\104\252\245\107"
	"\322\152\366\007\151\037\137\315\170\306\216\132\072\310\117\057"
	"\377\213\300\130\231\032\326\260\005\376\111\202\324\100\050\311"
	"\053\226\117\266\134\333\306\362\206\045\162\031\100\172\322\322"
	"\236\114\004\022\002\357\356\006\107\270\154\121\016\253\121\032"
	"\004\040\137\026\244\012\035\367\072\226\003\356\170\215\211\124"
	"\165\221\007\236\026\212\230\375\065\116\047\126\006\043\053\346"
	"\366\211\127\022\053\304\042\124\053\020\301\250\003\371\065\247"
	"\330\143\230\360\110\276\330\114\247\112\056\125\123\110\344\112"
	"\007\301\340\311\227\213\162\017\212\061\156\222\326\065\255\133"
	"\367\377\161\016\014\250\273\373\263\074\275\200\213\170\362\264"
	"\033\272\010\340\303\336\330\202\255\342\117\033\340\171\370\114"
	"\123\252\173\176\111\005\061\317\371\200\231\076\250\104\231\231"
	"\221\264\076\257\312\114\005\347\266\366\035\341\042\064\024\377"
	"\244\272\343\164\377\005\320\352\256\213\101\125\233\251\143\161"
	"\320\052\301\100\263\323\167\035\277\136\004\360\326\323\307\341"
	"\006\355\055\350\023\037\051\271\054\244\265\323\001\363\170\242"
	"\103\103\132\216\362\331\346\263\155\150\047\210\043\306\347\205"
	"\017\101\242\336\370\265\126\032\260\301\223\255\014\324\217\356"
	"\117\131\102\000\046\127\225\125\213\264\263\162\373\121\236\241"
	"\375\114\102\145\142\077\143\245\271\046\075\143\237\343\322\266"
	"\273\133\262\117\333\220\114\035\006\212\043\136\365\100\320\001"
	"\032\075\266\105\274\000\326\376\043\077\024\032\025\356\370\205"
	"\013\103\072\256\011\303\110\050\317\150\377\232\236\252\170\142"
	"\116\234\162\173\057\376\140\040\236\022\236\363\003\034\264\117"
	"\026\047\263\134\335\175\351\023\023\322\217\272\316\132\252\310"
	"\047\233\114\357\362\060\044\262\033\036\347\144\262\134\100\143"
	"\051\156\156\146\153\274\057\254\017\242\170\171\360\277\221\323"
	"\041\077\335\116\062\156\254\030\054\047\325\111\054\332\014\006"
	"\023\036\370\277\010\300\325\126\215\134\110\265\052\034\234\043"
	"\156\206\073\073\116\047\035\261\314\063\376\207\177\031\356\074"
	"\027\077\317\311\205\155\350\347\272\015\076\177\054\005\022\145"
	"\263\312\225\245\231\165\107\230\073\206\172\031\213\051\356\057"
	"\126\273\330\051\021\216\155\251\365\245\035\144\233\210\131\116"
	"\345\241\000\371\273\365\013\120\354\373\031\106\075\327\230\050"
	"\162\041\165\111\227\024\013\104\133\116\232\301\215\073\213\011"
	"\156\143\231\066\166\277\134\017\312\275\006\242\323\023\134\323"
	"\347\216\330\257\170\140\277\377\234\125\312\132\225\163\276\140"
	"\043\131\040\175\047\047\246\147\172\062\054\331\146\144\030\203"
	"\245\277\246\206\141\254\205\000\153\330\065\147\352\216\131\262"
	"\203\375\313\312\046\315\154\260\056\003\130\314\035\015\063\134"
	"\036\167\062\230\230\276\122\266\274\163\304\311\317\225\044\253"
	"\027\151\152\077\023\055\271\015\146\376\171\101\170\254\130\324"
	"\350\307\151\311\013\274\300\205\315\175\346\021\357\277\047\003"
	"\022\251\032\367\116\047\173\317\337\125\313\143\151\172\010\353"
	"\307\157\347\171\106\354\045\215\324\206\116\070\325\011\367\310"
	"\172\354\007\332\037\165\064\347\171\326\324\250\112\104\074\364"
	"\336\122\112\235\320\106\241\106\171\205\035\314\245\207\316\233"
	"\010\173\261\347\002\232\050\111\030\216\145\167\330\231\112\355"
	"\177\140\047\015\132\134\201\114\310\033\016\227\101\166\126\232"
	"\334\331\160\240\332\242\265\144\320\021\031\004\062\246\031\103"
	"\205\156\166\156\177\142\255\040\173\001\311\257\054\217\315\210"
	"\352\277\275\264\344\336\211\124\050\327\160\344\103\352\216\041"
	"\357\257\227\117\330\177\124\376\027\366\263\070\123\133\305\101"
	"\111\312\355\253\226\321\316\045\164\007\140\024\177\244\136\155"
	"\233\202\022\222\150\007\301\154\255\347\320\127\110\054\217\271"
	"\060\054\140\017\041\360\362\230\010\074\071\245\156\002\066\166"
	"\371\127\227\235\273\246\237\376\362\023\376\103\132\223\005\100"
	"\022\161\200\024\163\024\000\174\373\016\213\324\131\152\004\163"
	"\141\143\150\364\042\106\352\001\334\046\350\237\202\126\344\376"
	"\265\372\141\143\143\162\306\031\060\124\077\204\211\373\116\234"
	"\050\250\247\377\323\025\372\206\320\022\172\110\102\052\331\357"
	"\074\361\321\344\012\136\357\053\371\111\352\207\224\017\300\302"
	"\011\277\342\145\342\225\050\057\054\142\004\230\002\271\040\221"
	"\272\322\023\032\261\326\057\061\262\222\013\306\260\211\277\021"
	"\121\160\243\036\162\044\051\010\124\131\100\151\116\335\127\043"
	"\364\372\222\100\145\272\377\233\002\172\147\070\145\165\150\060"
	"\006\222\315\300\161\105\047\147\033\361\012\055\143\214\175\144"
	"\106\235\033\114\365\163\263\030\167\260\271\015\011\277\205\336"
	"\105\275\072\144\145\035\347\061\124\236\343\033\317\162\274\050"
	"\131\156\251\114\042\155\176\012\054\037\101\032\161\226\236\246"
	"\276\103\310\357\312\310\103\302\360\262\330\056\114\154\221\352"
	"\354\060\233\344\257\132\214\140\224\160\014\160\172\346\110\250"
	"\365\175\307\233\127\317\147\173\214\050\252\263\017\303\057\273"
	"\355\247\253\052\372\051\366\237\364\332\036\313\046\006\163\034"
	"\204\072\270\334\012\040\130\226\110\002\112\130\306\171\023\263"
	"\040\276\336\033\350\324\272\334\257\331\247\325\340\033\361\144"
	"\126\251\101\140\311\231\367\022\234\102\153\142\274\176\026\334"
	"\075\364\370\046\311\263\002\170\215\252\115\155\306\077\322\034"
	"\351\023\175\263\255\164\306\111\267\061\253\163\260\302\120\356"
	"\266\110\024\177\374\026\370\211\301\106\367\207\206\311\243\157"
	"\335\041\043\213\226\351\324\115\033\200\300\313\102\020\272\371"
	"\131\316\171\125\345\161\337\246\267\327\056\075\241\322\255\176"
	"\363\320\012\211\272\336\326\325\137\227\241\242\247\133\233\000"
	"\052\024\126\017\206\066\266\076\015\344\173\256\266\050\055\252"
	"\371\067\063\264\026\012\212\166\241\053\030\111\207\264\112\261"
	"\311\241\301\117\327\167\215\345\133\011\224\022\062\301\274\053"
	"\371\360\340\017\373\152\205\235\226\236\346\035\122\061\317\033"
	"\322\221\153\252\010\370\217\144\002\043\166\064\345\063\140\336"
	"\044\100\356\037\252\163\274\100\021\243\136\144\325\056\177\247"
	"\277\353\122"
#define      opts_z	1
#define      opts	((&data[3349]))
	"\324"
#define      date_z	1
#define      date	((&data[3350]))
	"\143"
#define      msg2_z	19
#define      msg2	((&data[3351]))
	"\251\263\266\114\260\353\073\215\321\155\000\230\152\061\170\072"
	"\232\062\214\327\172\311\373"
#define      rlax_z	1
#define      rlax	((&data[3374]))
	"\121"
#define      xecc_z	15
#define      xecc	((&data[3375]))
	"\161\142\130\173\214\265\315\253\275\314\342\112\064\176\100\245"
	"\075\174"
#define      msg1_z	42
#define      msg1	((&data[3399]))
	"\062\042\370\362\015\113\357\070\124\152\327\050\303\345\333\354"
	"\213\355\142\317\345\167\050\027\316\124\063\125\016\137\165\375"
	"\065\226\223\307\312\346\015\066\217\244\073\017\076\240\363\030"
	"\272\361\055"
#define      tst2_z	19
#define      tst2	((&data[3448]))
	"\212\362\036\142\232\215\306\211\366\114\163\031\115\136\052\211"
	"\372\306\110\234\321\034\266"
#define      tst1_z	22
#define      tst1	((&data[3472]))
	"\047\240\171\215\314\067\274\174\305\340\207\175\274\376\302\167"
	"\107\356\027\170\034\117\360\355\213\000\075\121\063"
#define      chk1_z	22
#define      chk1	((&data[3500]))
	"\254\036\152\316\220\252\160\356\116\042\272\122\254\056\225\351"
	"\326\035\073\145\372\075\027\157\322\325\027"
#define      chk2_z	19
#define      chk2	((&data[3527]))
	"\027\315\220\376\252\166\222\267\133\135\304\222\251\006\365\165"
	"\120\100\103\331\201\114\022\245"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = getenv("_");
	if (me == NULL) { me = argv[0]; }

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
